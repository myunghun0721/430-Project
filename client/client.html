<!DOCTYPE html>
<html lang="en">
<head>
  <title>When to play?</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  <link href="https://fonts.googleapis.com/css?family=Dosis:200,400,700" rel="stylesheet">
  
  <script>
    const handleResponse = (xhr, parseResponse) => {
      const content = document.querySelector('#content');
      
      switch(xhr.status){
        case 200:
          content.innerHTML = '<b>Success!</b>'
          break;
        case 201:
          content.innerHTML = '<b>Created!</b>'
          break;
        case 204:
          content.innerHTML = '<b>Updated (No Content)!</b>'
          break;
        case 400:
          content.innerHTML = '<b>Bad Request!</b>'
          break;
        default:
          content.innerHTML = '<b>Resource Not Found</b>'
          break;
      }
      parseJSON(xhr, content);
    };

    const parseJSON = (xhr, content) => {
      if(xhr.response && xhr.getResponseHeader('Content-Type') === 'application/json'){
        const obj = JSON.parse(xhr.response);

        for(let game in obj.games) {
          const gameDiv = document.createElement('div');
          const gameTitle = document.createElement('h2');
          const gameDate = document.createElement('b');
          const gameTime = document.createElement('p');

          gameTitle.textContent = obj.games[game].name;
          gameDate.textContent = "Playing on: " + obj.games[game].date;
          gameTime.textContent = "Playing at: " + obj.games[game].time;
          
           gameDiv.classList.add('game');
           gameDiv.id = encodeURIComponent(game.trim());
           gameDiv.appendChild(gameTitle);
           gameDiv.appendChild(gameDate);
           gameDiv.appendChild(gameTime);
          
           gameDiv.setAttribute("onclick", "getGameInfo()");
           content.appendChild(gameDiv);
        }
      }
    };



    const sendPost = (e, schedule) => {
      e.preventDefault();

      const nameAction = schedule.getAttribute('action');
      const nameMethod = schedule.getAttribute('method');

      const nameField = schedule.querySelector('#nameField');
      const dateField = schedule.querySelector('#dateField');
      const timeField = schedule.querySelector('#timeField');

      const xhr = new XMLHttpRequest();
      xhr.open(nameMethod, nameAction);

      xhr.setRequestHeader('Accept', 'application/json');
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

      xhr.onload = () => handleResponse(xhr);
      const formData = `name=${nameField.value}&date=${dateField.value}&time=${timeField.value}`;
      xhr.send(formData);

      return false;
    };

    const requestUpdate = (e, userForm) => {
      //const url = userForm.querySelector('#urlField').value;
      const url = userButton.value;
      //const method = userForm.querySelector('#methodSelect').value;
      const method = 'get';

      const xhr = new XMLHttpRequest();
      xhr.open(method, url);

      xhr.setRequestHeader('Accept', 'application/json');

      if(method === 'get'){
        xhr.onload = () => handleResponse(xhr, true);
      } else{
        xhr.onload = () => handleResponse(xhr, false);
      }

      xhr.send();

      e.preventDefault();
      return false;
    };
    
    const init = () => {
      //name form
      const schedule = document.querySelector('#schedule'); 
      const addGame = (e) => sendPost(e, schedule);  
      schedule.addEventListener('submit', addGame);

      //user form
      const getButton = document.querySelector('#userButton')
      const userForm = document.querySelector('#userForm');     
      //const getGames = (e) => requestUpdate(e, userForm); 
      const getGames = (e) => requestUpdate(e, getButton); 
      //userForm.addEventListener('submit', getGames);

      getButton.addEventListener('click', getGames);

      // let myElement = document.querySelector('#hide');
      //  myElement.style.display = 'none';
    };

    window.onload = init;


    function togglePopup(){
      document.querySelector("#popup-1").classList.toggle("active");
    }

    function getGameInfo(){
      document.querySelector("#popup-2").classList.toggle("active");
    }
  </script>
</head>
<body>
  <ul class="nav">
    <h2 class="logo">When to play?</h2>
  </ul>

  <button class="postButton" onclick="togglePopup()">Create new schedule</button>
  <br>
  <button id="userButton" class="postButton" value="/getGames" method='get'>Get schedules</button>

  <!-- <form id=hide>
  <section id="top">
    <form id="userForm" action="/getGames" method="get">
      <select id='urlField'>
        <option value='/getGames'>/getGames</option>
        <option value='/notReal'>/notReal</option>
      </select>
      <select id="methodSelect">
        <option value="get">GET</option>
        <option value="head">HEAD</option>
      </select>
      <input class="postButton" type="submit" value="Get schedule" />
    </form>
  </section>
</form> -->

  <section id="content">
  </section>
  

  <div class="popup" id="popup-1">
    <div class="overlay"></div>
    <div class="content">
      <div class="close-btn" onclick="togglePopup()">&times;</div>
      <form id="schedule" action="/addGame" method="post">
        <h2>Schedule Game</h2>
        <label for="name">Game name: </label>
        <select id="nameField" type="text" name="name">
          <option value="Among_us">Among us</option>
          <option value="League_of_legends">League of legends</option>
          <option value="Teamfight_tactics">Teamfight tactics</option>
          <option value="Fall_guys">Fall guys</option>
          <option value="Overwatch">Overwatch</option>
          <option value="Starcraft">Starcraft</option>
        </select>
        <label for="date">Date: </label>
        <input id="dateField" type="date" name="date" value="2020-09-27" min="2020-01-01" max="2100-12-31">
        <br>
        <label for="time">Time: </label>
        <input id="timeField" type="time" name="appt" required>
        <br>
        <input class="postButton" type="submit" value="Post Game" />
      </form>
    </div>
  </div>


  <div class="popup" id="popup-2">
    <div class="overlay"></div>
    <div class="content">
      <div class="close-btn" onclick="getGameInfo()">&times;</div>
        <p>test</p>
      </form>
    </div>
  </div>

<!-- <form>
  <div class="segment">
    <h1>Sign up</h1>
  </div>
  
  <label>
    <input type="text" placeholder="Email Address"/>
  </label>
  <label>
    <input type="password" placeholder="Password"/>
  </label>
  <button class="red" type="button"><i class="icon ion-md-lock"></i> Log in</button>
  
  <div class="segment">
    <button class="unit" type="button"><i class="icon ion-md-arrow-back"></i></button>
    <button class="unit" type="button"><i class="icon ion-md-bookmark"></i></button>
    <button class="unit" type="button"><i class="icon ion-md-settings"></i></button>
  </div>
  
  <div class="input-group">
    <label>
      <input type="text" placeholder="Email Address"/>
    </label>
    <button class="unit" type="button"><i class="icon ion-md-search"></i></button>
  </div> 
</form> -->

</body>
</html>
