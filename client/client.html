<!DOCTYPE html>
<html lang="en">
<head>
  <title>When to play?</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  <link href="https://fonts.googleapis.com/css?family=Dosis:200,400,700" rel="stylesheet">
  
  <script>
    const handleResponse = (xhr, parseResponse) => {
      const content = document.querySelector('#content');
      
      switch(xhr.status){
        case 200:
          content.innerHTML = '<b>Success!</b>'
          break;
        case 201:
          content.innerHTML = '<b>Created!</b>'
          break;
        case 204:
          content.innerHTML = '<b>Updated (No Content)!</b>'
          break;
        case 400:
          content.innerHTML = '<b>Bad Request!</b>'
          break;
        default:
          content.innerHTML = '<b>Resource Not Found</b>'
          break;
      }
      parseJSON(xhr, content);
    };

    const parseJSON = (xhr, content) => {
      if(xhr.response && xhr.getResponseHeader('Content-Type') === 'application/json'){
        const obj = JSON.parse(xhr.response);

        for(let game in obj.games) {
          const gameDiv = document.createElement('div');
          const gameTitle = document.createElement('h2');
          const gameDate = document.createElement('b');
          const gameTime = document.createElement('p');

          gameTitle.textContent = obj.games[game].name;
          gameDate.textContent = "Playing on: " + obj.games[game].date;
          gameTime.textContent = "Playing at: " + obj.games[game].time;
          
           gameDiv.classList.add('game');
           gameDiv.id = encodeURIComponent(game.trim());
           gameDiv.appendChild(gameTitle);
           gameDiv.appendChild(gameDate);
           gameDiv.appendChild(gameTime);
          
           content.appendChild(gameDiv);
        }
      }
    };



    const sendPost = (e, schedule) => {
      e.preventDefault();

      const nameAction = schedule.getAttribute('action');
      const nameMethod = schedule.getAttribute('method');

      const nameField = schedule.querySelector('#nameField');
      const dateField = schedule.querySelector('#dateField');
      const timeField = schedule.querySelector('#timeField');

      const xhr = new XMLHttpRequest();
      xhr.open(nameMethod, nameAction);

      xhr.setRequestHeader('Accept', 'application/json');
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

      xhr.onload = () => handleResponse(xhr);
      const formData = `name=${nameField.value}&date=${dateField.value}&time=${timeField.value}`;
      xhr.send(formData);

      return false;
    };

    const requestUpdate = (e, userForm) => {
      const url = userForm.querySelector('#urlField').value;
      const method = userForm.querySelector('#methodSelect').value;
      
      const xhr = new XMLHttpRequest();
      xhr.open(method, url);

      xhr.setRequestHeader('Accept', 'application/json');

      if(method === 'get'){
        xhr.onload = () => handleResponse(xhr, true);
      } else{
        xhr.onload = () => handleResponse(xhr, false);
      }

      xhr.send();

      e.preventDefault();
      return false;
    };
    
    const init = () => {
      //name form
      const schedule = document.querySelector('#schedule'); 
      const addGame = (e) => sendPost(e, schedule);  
      schedule.addEventListener('submit', addGame);

      //user form
      const userForm = document.querySelector('#userForm');     
      const getGames = (e) => requestUpdate(e, userForm); 
      userForm.addEventListener('submit', getGames);
    };

    window.onload = init;
    function togglePopup(){
      document.querySelector("#popup-1").classList.toggle("active");
    }
  </script>
</head>
<body>
  <section id="top">
    <h1>Schedule Your Game</h1>
    <form id="schedule" action="/addGame" method="post">
      <label for="name">Game name: </label>
      <select id="nameField" type="text" name="name">
        <option value="Among_us">Among us</option>
        <option value="League_of_legends">League of legends</option>
        <option value="Teamfight_tactics">Teamfight tactics</option>
        <option value="Fall_guys">Fall guys</option>
        <option value="Overwatch">Overwatch</option>
        <option value="Starcraft">Starcraft</option>
      </select>
      <label for="date">Date: </label>
      <input id="dateField" type="date" name="date" value="2020-09-27" min="2020-01-01" max="2100-12-31">
      <label for="time">Set time: </label>
      <input id="timeField" type="time" name="appt" required>
      <input type="submit" value="Post Game" />
    </form>
    <hr>
    <form id="userForm" action="/getGames" method="get">
      <select id='urlField'>
        <option value='/getGames'>/getGames</option>
        <option value='/notReal'>/notReal</option>
      </select>
      <select id="methodSelect">
        <option value="get">GET</option>
        <option value="head">HEAD</option>
      </select>
      <input type="submit" value="Send" />
    </form>
  </section>
  <section id="content">
  </section>
  



  <div id="lol"></div>
  <div id="tft"></div>
  <div id="fall"></div>
  <div id="overwatch"></div>
  <div id="starcraft"></div>


  <div class="popup" id="popup-1">
    <div class="overlay"></div>
    <div class="content">
      <div class="close-btn" onclick="togglePopup()">&times;</div>
      <p>content goes here</p>
    </div>
  </div>

<form id="among">
</form>

<button onclick="togglePopup()">popup test</button>
</body>
</html>
